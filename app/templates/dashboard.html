<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Ph√≤ng Tr·ªç Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS Files -->
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/expense.css">
    <link rel="stylesheet" href="/static/css/games.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-home"></i></div>
            <h1>Ph√≤ng Tr·ªç Manager</h1>
        </div>
        <div class="user-info">
            <div class="user-badge">
                <div class="user-avatar" id="userAvatar"></div>
                <span id="userName">ƒêang t·∫£i...</span>
            </div>
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Tho√°t
            </button>
        </div>
    </header>

    <nav class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('expense')">
            <i class="fas fa-chart-pie"></i> Th·ªëng K√™ Chi Ti√™u
        </button>
        <button class="nav-tab" onclick="switchTab('games')">
            <i class="fas fa-gamepad"></i> Tr√≤ Ch∆°i
        </button>
    </nav>

    <main class="content">
        <!-- EXPENSE TAB -->
        <div id="expenseTab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">T·ªïng chi ti√™u</div>
                    <div class="value money" id="totalAmount">0 VND</div>
                </div>
                <div class="stat-card">
                    <div class="label">S·ªë giao d·ªãch</div>
                    <div class="value" id="totalCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="label">Trung b√¨nh/giao d·ªãch</div>
                    <div class="value" id="avgAmount">0 VND</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title"><i class="fas fa-plus-circle"></i> Th√™m Chi Ti√™u</div>
                <form class="expense-form" id="expenseForm" onsubmit="addExpense(event)">
                    <div class="form-group">
                        <label>Ng∆∞·ªùi tr·∫£</label>
                        <input type="text" id="expenseName" placeholder="T√™n..." required list="nameSuggestions">
                        <datalist id="nameSuggestions"></datalist>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ti·ªÅn (ngh√¨n ƒë·ªìng)</label>
                        <input type="number" id="expenseAmount" placeholder="VD: 50 = 50,000" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label>M·ª•c ƒë√≠ch</label>
                        <input type="text" id="expensePurpose" placeholder="Mua g√¨..." required>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn-add">
                            <i class="fas fa-plus"></i> Th√™m
                        </button>
                        <button type="button" class="btn-cancel" onclick="cancelEdit()" style="display: none;">
                            <i class="fas fa-times"></i> H·ªßy
                        </button>
                    </div>
                </form>
                <div class="participants-section" style="margin-top: 16px;">
                    <label style="font-size: 0.85rem; color: #4a5568; font-weight: 500;">
                        <i class="fas fa-user-check"></i> Ng∆∞·ªùi tham gia (b·ªè tr·ªëng = t·∫•t c·∫£):
                    </label>
                    <div class="participants-checkboxes" id="participantsCheckboxes" style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title"><i class="fas fa-balance-scale"></i> T√≠nh Ti·ªÅn Chia</div>
                <div id="balanceSection">
                    <div class="balance-summary" id="balanceSummary" style="margin-bottom: 16px;"></div>
                    <div class="balance-details" id="balanceDetails"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title"><i class="fas fa-users"></i> Th·ªëng K√™ Theo Ng∆∞·ªùi</div>
                <div class="people-grid" id="peopleStats"></div>
            </div>

            <div class="section">
                <div class="section-title"><i class="fas fa-list"></i> Danh S√°ch Chi Ti√™u</div>
                <table class="expense-table">
                    <thead>
                        <tr>
                            <th>Ng∆∞·ªùi</th>
                            <th>S·ªë ti·ªÅn</th>
                            <th>M·ª•c ƒë√≠ch</th>
                            <th>Ng√†y</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="expenseList"></tbody>
                </table>
            </div>
        </div>

        <!-- GAMES TAB -->
        <div id="gamesTab" class="tab-content">
            <!-- Online Players Section -->
            <div class="online-section">
                <div class="online-header">
                    <div class="section-title" style="margin-bottom: 0;">
                        <i class="fas fa-users"></i> Ng∆∞·ªùi Ch∆°i Online
                    </div>
                    <div class="online-count">
                        <span class="online-dot"></span>
                        <span id="onlineCount">0 online</span>
                    </div>
                </div>

                <div class="best-of-selector" style="margin-bottom: 16px;">
                    <span style="color: #718096; margin-right: 8px;">Ch·∫ø ƒë·ªô:</span>
                    <button class="best-of-btn" data-value="1">B·ªô 1</button>
                    <button class="best-of-btn active" data-value="3">B·ªô 3</button>
                    <button class="best-of-btn" data-value="5">B·ªô 5</button>
                </div>

                <div class="online-grid" id="onlinePlayersGrid">
                    <div class="no-players">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>ƒêang k·∫øt n·ªëi...</p>
                    </div>
                </div>
            </div>

            <div class="games-grid">
                <div class="game-card">
                    <div class="game-icon rps">&#9994;&#9995;&#9996;</div>
                    <h3>O·∫≥n T√π T√¨</h3>
                    <p>M·ªùi ng∆∞·ªùi ch∆°i online ·ªü tr√™n!</p>
                    <button class="btn-play" onclick="openRPSModal()">
                        <i class="fas fa-door-open"></i> V√†o Ph√≤ng
                    </button>
                </div>

                <div class="game-card">
                    <div class="game-icon wheel">&#127921;</div>
                    <h3>V√≤ng Quay May M·∫Øn</h3>
                    <p>Ai s·∫Ω l√† ng∆∞·ªùi may m·∫Øn?</p>
                    <button class="btn-play" onclick="openWheelModal()">
                        <i class="fas fa-sync"></i> Quay
                    </button>
                </div>

                <div class="game-card">
                    <div class="game-icon dice">&#127922;</div>
                    <h3>X√∫c X·∫Øc</h3>
                    <p>2-6 ng∆∞·ªùi, ai cao ƒëi·ªÉm nh·∫•t th·∫Øng!</p>
                    <button class="btn-play" onclick="openDiceModal()">
                        <i class="fas fa-dice"></i> Ch∆°i
                    </button>
                </div>
            </div>

            <div class="section leaderboard">
                <div class="section-title"><i class="fas fa-trophy"></i> B·∫£ng X·∫øp H·∫°ng</div>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ng∆∞·ªùi ch∆°i</th>
                            <th>Th·∫Øng</th>
                            <th>Thua</th>
                            <th>T·ªâ l·ªá</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard"></tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- RPS Modal -->
    <div class="modal" id="rpsModal">
        <div class="modal-content">
            <h2><i class="fas fa-gamepad"></i> O·∫≥n T√π T√¨</h2>

            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 1rem; margin-bottom: 12px;"><i class="fas fa-plus-circle"></i> T·∫°o Ph√≤ng M·ªõi</h3>
                <p style="color: #718096; margin-bottom: 12px; font-size: 0.9rem;">T·∫°o ph√≤ng v√† chia s·∫ª m√£ cho b·∫°n b√®</p>
                <button class="btn-primary" onclick="createGameRoom()" style="width: 100%;">
                    <i class="fas fa-plus"></i> T·∫°o Ph√≤ng
                </button>
            </div>

            <div style="border-top: 1px solid #e2e8f0; padding-top: 20px;">
                <h3 style="font-size: 1rem; margin-bottom: 12px;"><i class="fas fa-sign-in-alt"></i> V√†o Ph√≤ng C√≥ S·∫µn</h3>
                <p style="color: #718096; margin-bottom: 12px; font-size: 0.9rem;">Nh·∫≠p m√£ ph√≤ng ƒë·ªÉ tham gia</p>
                <input type="text" id="joinRoomCode" placeholder="Nh·∫≠p m√£ ph√≤ng 6 k√Ω t·ª±" maxlength="6" style="text-transform: uppercase;">
                <button class="btn-primary" onclick="joinGameRoom()" style="width: 100%; margin-top: 8px;">
                    <i class="fas fa-sign-in-alt"></i> Tham Gia
                </button>
            </div>

            <div class="modal-buttons" style="margin-top: 20px;">
                <button class="btn-secondary" onclick="closeModal('rpsModal')">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Invite Toast Container -->
    <div id="inviteToastContainer"></div>

    <!-- Dice Modal -->
    <div class="modal" id="diceModal">
        <div class="modal-content" style="max-width: 650px;">
            <h2><i class="fas fa-dice"></i> X√∫c X·∫Øc (2-6 ng∆∞·ªùi)</h2>

            <!-- Setup Phase -->
            <div id="diceSetup">
                <div style="margin-bottom: 16px;">
                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">
                        <i class="fas fa-users"></i> Ch·ªçn ng∆∞·ªùi ch∆°i: <span id="diceSelectedCount" style="color: #718096;">(0/6)</span>
                    </label>
                    <div id="dicePlayerSelect" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;"></div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-secondary" onclick="selectAllDicePlayers()" style="padding: 6px 12px; font-size: 0.85rem;">
                            <i class="fas fa-check-double"></i> Ch·ªçn t·∫•t c·∫£
                        </button>
                        <button class="btn-secondary" onclick="deselectAllDicePlayers()" style="padding: 6px 12px; font-size: 0.85rem;">
                            <i class="fas fa-times"></i> B·ªè ch·ªçn
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="font-weight: 600; display: block; margin-bottom: 8px;">
                        <i class="fas fa-redo"></i> S·ªë l∆∞·ª£t ch∆°i:
                    </label>
                    <div style="display: flex; gap: 8px;">
                        <button class="dice-round-btn active" data-rounds="1">1 l∆∞·ª£t</button>
                        <button class="dice-round-btn" data-rounds="3">3 l∆∞·ª£t</button>
                        <button class="dice-round-btn" data-rounds="5">5 l∆∞·ª£t</button>
                    </div>
                </div>

                <button class="btn-primary" onclick="startDiceGame()" style="width: 100%; padding: 14px;">
                    <i class="fas fa-play"></i> B·∫Øt ƒê·∫ßu Ch∆°i
                </button>
            </div>

            <!-- Game Phase -->
            <div id="diceGame" style="display: none;">
                <div id="diceRoundInfo" style="text-align: center; margin-bottom: 16px; font-weight: 600; color: #667eea;"></div>
                <div id="dicePlayers" style="display: grid; gap: 12px; margin-bottom: 20px;"></div>
                <div id="diceArea" style="text-align: center; margin: 20px 0;">
                    <div id="currentPlayerTurn" style="font-size: 1.1rem; font-weight: 600; margin-bottom: 12px; color: #2d3748;"></div>
                    <div id="diceDisplay" style="font-size: 80px; margin: 20px 0; min-height: 100px; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        <span class="dice-face">üé≤</span>
                        <span class="dice-face">üé≤</span>
                    </div>
                    <button id="rollDiceBtn" class="btn-primary" onclick="rollDice()" style="padding: 14px 40px; font-size: 1.1rem;">
                        <i class="fas fa-dice"></i> L·∫ÆC X√öC X·∫ÆC
                    </button>
                </div>
            </div>

            <!-- Result Phase -->
            <div id="diceResult" style="display: none;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; margin-bottom: 8px;">üèÜ</div>
                    <h3 style="color: #2d3748;">K·∫øt Qu·∫£ X√∫c X·∫Øc</h3>
                </div>
                <div id="diceRanking"></div>
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button class="btn-primary" onclick="resetDiceGame()" style="flex: 1;">
                        <i class="fas fa-redo"></i> Ch∆°i L·∫°i
                    </button>
                    <button class="btn-secondary" onclick="closeModal('diceModal')" style="flex: 1;">
                        <i class="fas fa-times"></i> ƒê√≥ng
                    </button>
                </div>
            </div>

            <div class="modal-buttons" id="diceCloseBtn">
                <button class="btn-secondary" onclick="closeModal('diceModal')">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Wheel Modal -->
    <div class="modal" id="wheelModal">
        <div class="modal-content" style="max-width: 600px;">
            <h2><i class="fas fa-sync"></i> V√≤ng Quay May M·∫Øn</h2>

            <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">
                    <i class="fas fa-users"></i> Ch·ªçn ng∆∞·ªùi tham gia:
                </label>
                <div id="wheelParticipants" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px;"></div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn-secondary" onclick="selectAllWheelParticipants()" style="padding: 6px 12px; font-size: 0.85rem;">
                        <i class="fas fa-check-double"></i> Ch·ªçn t·∫•t c·∫£
                    </button>
                    <button class="btn-secondary" onclick="deselectAllWheelParticipants()" style="padding: 6px 12px; font-size: 0.85rem;">
                        <i class="fas fa-times"></i> B·ªè ch·ªçn
                    </button>
                </div>
            </div>

            <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">
                    <i class="fas fa-redo"></i> S·ªë l·∫ßn quay:
                </label>
                <div style="display: flex; gap: 8px;">
                    <button class="spin-count-btn active" data-count="1">1 l·∫ßn</button>
                    <button class="spin-count-btn" data-count="3">3 l·∫ßn</button>
                    <button class="spin-count-btn" data-count="5">5 l·∫ßn</button>
                </div>
            </div>

            <div class="wheel-container">
                <div class="wheel-canvas-wrapper">
                    <div class="wheel-pointer">‚ñº</div>
                    <canvas id="wheelCanvas" width="300" height="300"></canvas>
                    <div class="wheel-center">üéØ</div>
                </div>
            </div>

            <button class="btn-primary" onclick="spinWheel()" id="spinBtn" style="margin-bottom: 16px; padding: 14px 32px; font-size: 1.1rem;">
                <i class="fas fa-sync"></i> QUAY!
            </button>
            <div id="wheelResult" style="font-size: 1.3rem; font-weight: 700; color: #667eea; min-height: 40px;"></div>
            <div id="wheelHistory" style="margin-top: 12px; font-size: 0.9rem; color: #718096; min-height: 24px;"></div>

            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('wheelModal')">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files (Polling-based, no WebSocket) -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/expense.js"></script>
    <script src="/static/js/wheel.js"></script>
    <script src="/static/js/dice.js"></script>
    <script src="/static/js/lobby.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
